#!/bin/zsh

# This script finds all .mp4 files in the current directory
# and all subdirectories, then converts them to high-quality MP3s.

for file in **/*.mp4(.); do
  # Check if the MP3 file already exists to avoid re-converting
  if [[ ! -f "${file%.*}.mp3" ]]; then
    echo "Converting: $file"
    # Execute ffmpeg command
    # -i: input file
    # -vn: no video, audio only
    # -c:a libmp3lame: specify the mp3 codec
    # -q:a 2: set VBR quality (2 is a great balance, ~192kbps)
    ffmpeg -i "$file" -vn -c:a libmp3lame -q:a 2 "${file%.*}.mp3"
  else
    echo "Skipping, MP3 already exists for: $file"
  fi
done

echo "\nConversion process complete."

